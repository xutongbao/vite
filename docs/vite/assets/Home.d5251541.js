var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,a=(e,o,s)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,l=(t,l)=>{for(var i in l||(l={}))e.call(l,i)&&a(t,i,l[i]);if(o)for(var i of o(l))s.call(l,i)&&a(t,i,l[i]);return t};import{a as i,u as n}from"./index.538049d5.js";import{c as r,o as c,e as d,x as u,u as m,F as p,B as b,j as g,b as y,A as k,g as h,y as v,T as C}from"./vendor.c0d264ef.js";import{_ as O}from"./Icon.05f83b1f.js";const f={expose:[],props:{sidebarItem:{type:Object}},setup(t){const e=i(),o=r((()=>e.state.light.currentId));return(s,a)=>(c(),d("div",{class:"m-sidebar-item "+(m(o)===t.sidebarItem.id?"active":""),onClick:a[1]||(a[1]=o=>{return s=t.sidebarItem.id,document.getElementById(s).scrollIntoView({block:"start",behavior:"smooth"}),e.commit({type:"setLightState",key:"currentId",value:s}),void e.commit({type:"setLightState",key:"isRealScroll",value:!1});var s})},u(t.sidebarItem.title),3))}},I={class:"m-sidebar"},S={expose:[],setup(t){const e=i(),o=r((()=>e.state.light.list));return(t,e)=>(c(),d("div",I,[(c(!0),d(p,null,b(m(o),(t=>(c(),d(f,{key:t.id,sidebarItem:t},null,8,["sidebarItem"])))),128))]))}},L={expose:[],props:{number:{type:Number,default:0}},setup:t=>(e,o)=>(c(),d("div",null,[(c(),d(p,null,b(5,(e=>g(O,{key:e,name:"star",className:"m-star "+(e<=t.number?"active":"")},null,8,["className"]))),64))]))},B={class:"m-category-item"},j=g("div",{class:"m-category-item-img-loading"},null,-1),x={class:"m-category-item-info"},T={class:"m-book-price"},A={expose:[],props:{book:{type:Object}},setup(t){const e=t,o=i(),s=n(),a=()=>{o.commit({type:"setLightState",key:"isListDialogVisible",value:!0});const t=e.book;t.count=1,o.commit({type:"setLightState",key:"addBook",value:t})};return(e,o)=>{const l=y("el-image");return c(),d("div",B,[g(l,{alt:t.book.title,src:t.book.avatar,lazy:"",class:"m-category-item-img",onClick:o[1]||(o[1]=e=>{return o=t.book.id,void s.push(`/light/detail/${o}`);var o})},{placeholder:k((()=>[j])),_:1},8,["alt","src"]),g("div",x,[g("div",null,u(t.book.title),1),g(L,{number:t.book.stars},null,8,["number"]),g("div",T,"￥"+u(t.book.price),1),g("button",{onClick:a},"添加")])])}}},w={class:"m-category-title"},N={expose:[],props:{category:{type:Object}},emits:["onTopArr"],setup:(t,{emit:e})=>(h((()=>{const t=[...document.getElementsByClassName("js-category")].map((t=>t.offsetTop));t.push(1/0),e("onTopArr",t)})),(e,o)=>(c(),d("div",{id:t.category.id,class:"js-category"},[g("div",w,u(t.category.title),1),(c(!0),d(p,null,b(t.category.list,(t=>(c(),d(A,{key:t.id,book:t},null,8,["book"])))),128))],8,["id"])))};let V,D=[];const E={class:"m-dialog"},P={class:"m-dialog-header"},R={class:"m-dialog-header-title"},_={class:"m-dialog-content"},$={expose:[],props:{visible:{type:Boolean},title:{type:String}},emits:["onClose","onOk"],setup(t,{emit:e}){const o=()=>{e("onClose")},s=()=>{e("onOk")};return(e,a)=>(c(),d("div",{class:["m-mask "+(t.visible?"active":"")]},[g("div",E,[g("div",P,[g("span",R,u(t.title),1),g("span",{class:"m-dialog-header-close",onClick:o},"X")]),g("div",_,[v(e.$slots,"content")]),g("div",{class:"m-dialog-footer"},[g("button",{class:"m-btn",onClick:o},"取消"),g("button",{class:"m-btn",onClick:s},"确定")])])],2))}},z={class:"m-add-wrap"},F={class:"m-add"},M={expose:[],setup(t){const e=i(),o=r((()=>e.state.light.list));r((()=>e.state.light.currentId));const s=r((()=>e.state.light.addBook)),a=r((()=>e.state.light.isListDialogVisible)),{handleScroll:n,handleTopArr:u}=(()=>{const t=i();return{handleScroll:e=>{if(t.state.light.isRealScroll){let{scrollTop:o}=e.target;o+=D[0];const s=D.findIndex(((t,e,s)=>t<=o&&o<s[e+1]));s!==t.state.light.currentId&&t.commit({type:"setLightState",key:"currentId",value:s})}else clearTimeout(V),V=setTimeout((()=>{t.commit({type:"setLightState",key:"isRealScroll",value:!0})}),300)},handleTopArr:t=>{D=t}}})(),{handleClose:y,handleOk:h,handleAddCount:v,handleSubCount:O,handleInputCount:f}=(()=>{const t=i(),e=()=>{t.commit({type:"setLightState",key:"isListDialogVisible",value:!1})};return{handleClose:e,handleOk:async()=>{const o=t.state.light.addBook;""!==o.count&&t.dispatch({type:"addMyBooks",book:o}).then((()=>{e()}))},handleAddCount:()=>{const e=t.state.light.addBook;e.count++,t.commit({type:"setLightState",key:"addBook",value:e})},handleSubCount:()=>{const e=t.state.light.addBook;e.count>1&&(e.count--,t.commit({type:"setLightState",key:"addBook",value:e}))},handleInputCount:e=>{const o=t.state.light.addBook;o.count=e.target.value.replace(/[^\d]/g,""),""!==o.count&&(o.count=parseInt(o.count)),t.commit({type:"setLightState",key:"addBook",value:l({},o)})}}})();return(t,e)=>(c(),d("div",{class:"m-list",onScroll:e[4]||(e[4]=(...t)=>m(n)&&m(n)(...t))},[(c(!0),d(p,null,b(m(o),(t=>(c(),d(N,{key:t.id,category:t,onOnTopArr:m(u)},null,8,["category","onOnTopArr"])))),128)),(c(),d(C,{to:"body"},[g($,{visible:m(a),title:"添加",onOnClose:m(y),onOnOk:m(h)},{content:k((()=>[g("div",z,[g("div",F,[g("button",{class:"m-btn",onClick:e[1]||(e[1]=(...t)=>m(O)&&m(O)(...t))},"-"),g("input",{type:"text",class:"m-add-input",value:m(s).count,onInput:e[2]||(e[2]=(...t)=>m(f)&&m(f)(...t))},null,40,["value"]),g("button",{class:"m-btn",onClick:e[3]||(e[3]=(...t)=>m(v)&&m(v)(...t))},"+")])])])),_:1},8,["visible","onOnClose","onOnOk"])]))],32))}};const X={class:"m-main m-home"},q={expose:[],setup(t){const e=i();return h((()=>{e.dispatch({type:"getLightList"})})),(t,e)=>(c(),d("div",X,[g(S),g(M)]))}};export default q;
//# sourceMappingURL=Home.d5251541.js.map
